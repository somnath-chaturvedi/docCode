@Configuration
public class JettyConfiguration {

    @Bean
    public JettyServletWebServerFactory jettyServletWebServerFactory() {
        JettyServletWebServerFactory factory = new JettyServletWebServerFactory();
        factory.addServerCustomizers(server -> {
            // Get the handler
            Handler.Collection handlers = (Handler.Collection) server.getHandler();
            
            // Find the ServletContextHandler
            for (Handler handler : handlers.getHandlers()) {
                if (handler instanceof ServletContextHandler) {
                    ServletContextHandler contextHandler = (ServletContextHandler) handler;
                    
                    // Create and configure security handler
                    SecurityHandler securityHandler = new SecurityHandler();
                    
                    // Create constraint to disable TRACE
                    Constraint traceConstraint = new Constraint.Builder()
                        .authorization(Constraint.Authorization.FORBIDDEN)
                        .build();
                    
                    // Map the constraint to TRACE method
                    ConstraintMapping traceMapping = new ConstraintMapping();
                    traceMapping.setPathSpec("/*");
                    traceMapping.setMethod("TRACE");
                    traceMapping.setConstraint(traceConstraint);
                    
                    // Add constraint mapping to security handler
                    securityHandler.setConstraintMappings(List.of(traceMapping));
                    
                    // Set the security handler on the context
                    contextHandler.setSecurityHandler(securityHandler);
                    break;
                }
            }
        });
        return factory;
    }
}
