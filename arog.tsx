import { useState } from "react"; import { Button } from "./ui/button"; import { Checkbox } from "./ui/checkbox"; import { Badge } from "./ui/badge"; import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "./ui/table"; import { ChevronRight, ChevronDown, CheckCircle2, MessageSquare } from "lucide-react"; import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, } from "./ui/dialog"; import { Textarea } from "./ui/textarea"; interface Question { id: string; question: string; response: string; responseComments: string; certifiedYesNo: boolean; certifiedBy: string; approverComments: string; } interface Section { id: string; name: string; questions: Question[]; } interface ResponseData { responseId: string; taskType: string; surveyName: string; controls: string; respondedBy: string; approver: string; status: "Pending" | "Approved" | "Clarification Requested"; questionnaire: string; sections: Section[]; } // Mock data const mockData: ResponseData[] = [ { responseId: "RESP-001", taskType: "Compliance Audit", surveyName: "Q4 2024 Security Assessment", controls: "ISO 27001", respondedBy: "John Smith", approver: "Sarah Johnson", status: "Pending", questionnaire: "Information Security Questionnaire", sections: [ { id: "SEC-001", name: "Access Control", questions: [ { id: "Q-001", question: "Are access controls regularly reviewed?", response: "Yes, we conduct quarterly reviews of all access permissions.", responseComments: "Last review completed on Oct 15, 2024", certifiedYesNo: true, certifiedBy: "John Smith", approverComments: "" }, { id: "Q-002", question: "Is multi-factor authentication enforced?", response: "MFA is enforced for all users accessing critical systems.", responseComments: "Implementation completed in Q2 2024", certifiedYesNo: true, certifiedBy: "John Smith", approverComments: "" } ] }, { id: "SEC-002", name: "Data Protection", questions: [ { id: "Q-003", question: "Is data encrypted at rest and in transit?", response: "Yes, using AES-256 for data at rest and TLS 1.3 for data in transit.", responseComments: "Encryption standards reviewed annually", certifiedYesNo: true, certifiedBy: "John Smith", approverComments: "" } ] } ] }, { responseId: "RESP-002", taskType: "Risk Assessment", surveyName: "Annual Risk Survey 2024", controls: "NIST Framework", respondedBy: "Emily Davis", approver: "Sarah Johnson", status: "Pending", questionnaire: "Cybersecurity Risk Questionnaire", sections: [ { id: "SEC-003", name: "Incident Response", questions: [ { id: "Q-004", question: "Is there a documented incident response plan?", response: "Yes, we maintain a comprehensive IRP that is tested quarterly.", responseComments: "Last drill conducted on Nov 1, 2024", certifiedYesNo: true, certifiedBy: "Emily Davis", approverComments: "" }, { id: "Q-005", question: "Are incidents logged and tracked?", response: "All incidents are logged in our SIEM system with full audit trails.", responseComments: "Integration with ticketing system completed", certifiedYesNo: true, certifiedBy: "Emily Davis", approverComments: "" } ] } ] } ]; export function ApprovalReport() { const [data] = useState<ResponseData[]>(mockData); const [expandedResponses, setExpandedResponses] = useState<Set<string>>(new Set()); const [expandedSections, setExpandedSections] = useState<Set<string>>(new Set()); const [selectedQuestions, setSelectedQuestions] = useState<Set<string>>(new Set()); const [dialogOpen, setDialogOpen] = useState(false); const [dialogType, setDialogType] = useState<"approve" | "clarify">("approve"); const [comments, setComments] = useState(""); const toggleResponse = (responseId: string) => { const newExpanded = new Set(expandedResponses); if (newExpanded.has(responseId)) { newExpanded.delete(responseId); } else { newExpanded.add(responseId); } setExpandedResponses(newExpanded); }; const toggleSection = (sectionId: string) => { const newExpanded = new Set(expandedSections); if (newExpanded.has(sectionId)) { newExpanded.delete(sectionId); } else { newExpanded.add(sectionId); } setExpandedSections(newExpanded); }; const toggleQuestion = (questionId: string) => { const newSelected = new Set(selectedQuestions); if (newSelected.has(questionId)) { newSelected.delete(questionId); } else { newSelected.add(questionId); } setSelectedQuestions(newSelected); }; const selectAllInResponse = (responseData: ResponseData, checked: boolean) => { const newSelected = new Set(selectedQuestions); responseData.sections.forEach(section => { section.questions.forEach(question => { if (checked) { newSelected.add(question.id); } else { newSelected.delete(question.id); } }); }); setSelectedQuestions(newSelected); }; const handleAction = (type: "approve" | "clarify") => { if (selectedQuestions.size === 0) { alert("Please select at least one item to proceed."); return; } setDialogType(type); setDialogOpen(true); }; const handleConfirmAction = () => { const action = dialogType === "approve" ? "approved" : "sent for clarification"; console.log(${selectedQuestions.size} item(s) ${action}); console.log("Comments:", comments); setSelectedQuestions(new Set()); setComments(""); setDialogOpen(false); }; const isResponseFullySelected = (responseData: ResponseData): boolean => { const allQuestionIds = responseData.sections.flatMap(s => s.questions.map(q => q.id) ); return allQuestionIds.every(id => selectedQuestions.has(id)); }; const isResponsePartiallySelected = (responseData: ResponseData): boolean => { const allQuestionIds = responseData.sections.flatMap(s => s.questions.map(q => q.id) ); const someSelected = allQuestionIds.some(id => selectedQuestions.has(id)); const allSelected = allQuestionIds.every(id => selectedQuestions.has(id)); return someSelected && !allSelected; }; return ( <div className="bg-white rounded-lg shadow"> <div className="p-4 border-b border-slate-200 flex items-center justify-between"> <div className="flex items-center gap-4"> <span className="text-slate-600"> {selectedQuestions.size} item(s) selected </span> </div> <div className="flex gap-2"> <Button onClick={() => handleAction("approve")} disabled={selectedQuestions.size === 0} className="bg-green-600 hover:bg-green-700" > <CheckCircle2 className="w-4 h-4 mr-2" /> Approve </Button> <Button onClick={() => handleAction("clarify")} disabled={selectedQuestions.size === 0} variant="outline" > <MessageSquare className="w-4 h-4 mr-2" /> Request Clarification </Button> </div> </div> <div className="overflow-x-auto"> <Table> <TableHeader> <TableRow> <TableHead className="w-[30px]"></TableHead> <TableHead className="w-[50px]">Select</TableHead> <TableHead className="min-w-[120px]">Response ID</TableHead> <TableHead className="min-w-[140px]">Task Type</TableHead> <TableHead className="min-w-[200px]">Survey Name</TableHead> <TableHead className="min-w-[120px]">Controls</TableHead> <TableHead className="min-w-[140px]">Responded By</TableHead> <TableHead className="min-w-[140px]">Approver</TableHead> <TableHead className="min-w-[120px]">Status</TableHead> <TableHead className="min-w-[200px]">Questionnaire</TableHead> <TableHead className="min-w-[180px]">Section</TableHead> <TableHead className="min-w-[300px]">Question</TableHead> <TableHead className="min-w-[300px]">Response</TableHead> <TableHead className="min-w-[200px]">Response Comments</TableHead> <TableHead className="min-w-[120px]">Certified</TableHead> <TableHead className="min-w-[140px]">Certified By</TableHead> <TableHead className="min-w-[200px]">Approver Comments</TableHead> </TableRow> </TableHeader> <TableBody> {data.map((responseData) => ( <> {/* Response ID Row */} <TableRow key={responseData.responseId} className="bg-slate-50 hover:bg-slate-100 cursor-pointer" onClick={() => toggleResponse(responseData.responseId)} > <TableCell> {expandedResponses.has(responseData.responseId) ? ( <ChevronDown className="w-4 h-4" /> ) : ( <ChevronRight className="w-4 h-4" /> )} </TableCell> <TableCell onClick={(e) => e.stopPropagation()}> <Checkbox checked={isResponseFullySelected(responseData)} ref={(el) => { if (el) { (el as any).indeterminate = isResponsePartiallySelected(responseData); } }} onCheckedChange={(checked) => selectAllInResponse(responseData, checked as boolean) } /> </TableCell> <TableCell>{responseData.responseId}</TableCell> <TableCell>{responseData.taskType}</TableCell> <TableCell>{responseData.surveyName}</TableCell> <TableCell>{responseData.controls}</TableCell> <TableCell>{responseData.respondedBy}</TableCell> <TableCell>{responseData.approver}</TableCell> <TableCell> <Badge variant={ responseData.status === "Approved" ? "default" : responseData.status === "Pending" ? "outline" : "secondary" } > {responseData.status} </Badge> </TableCell> <TableCell>{responseData.questionnaire}</TableCell> <TableCell colSpan={7} className="text-slate-500 italic"> {responseData.sections.length} section(s) </TableCell> </TableRow> {/* Sections and Questions */} {expandedResponses.has(responseData.responseId) && responseData.sections.map((section) => ( <> {/* Section Row */} <TableRow key={section.id} className="bg-blue-50 hover:bg-blue-100 cursor-pointer" onClick={() => toggleSection(section.id)} > <TableCell className="pl-8"> {expandedSections.has(section.id) ? ( <ChevronDown className="w-4 h-4" /> ) : ( <ChevronRight className="w-4 h-4" /> )} </TableCell> <TableCell></TableCell> <TableCell colSpan={8}></TableCell> <TableCell>{section.name}</TableCell> <TableCell colSpan={6} className="text-slate-500 italic"> {section.questions.length} question(s) </TableCell> </TableRow> {/* Question Rows */} {expandedSections.has(section.id) && section.questions.map((question) => ( <TableRow key={question.id} className="hover:bg-slate-50"> <TableCell className="pl-12"></TableCell> <TableCell onClick={(e) => e.stopPropagation()}> <Checkbox checked={selectedQuestions.has(question.id)} onCheckedChange={() => toggleQuestion(question.id)} /> </TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell></TableCell> <TableCell>{question.question}</TableCell> <TableCell>{question.response}</TableCell> <TableCell className="text-slate-600"> {question.responseComments} </TableCell> <TableCell> <Badge variant={question.certifiedYesNo ? "default" : "secondary"}> {question.certifiedYesNo ? "Yes" : "No"} </Badge> </TableCell> <TableCell>{question.certifiedBy}</TableCell> <TableCell className="text-slate-600"> {question.approverComments || "-"} </TableCell> </TableRow> ))} </> ))} </> ))} </TableBody> </Table> </div> <Dialog open={dialogOpen} onOpenChange={setDialogOpen}> <DialogContent> <DialogHeader> <DialogTitle> {dialogType === "approve" ? "Approve Selected Items" : "Request Clarification"} </DialogTitle> <DialogDescription> {dialogType === "approve" ? You are about to approve ${selectedQuestions.size} item(s). Add comments below (optional). : You are requesting clarification for ${selectedQuestions.size} item(s). Please provide your comments. } </DialogDescription> </DialogHeader> <div className="py-4"> <Textarea placeholder={dialogType === "approve" ? "Add approval comments..." : "Describe what needs clarification..."} value={comments} onChange={(e) => setComments(e.target.value)} rows={4} /> </div> <DialogFooter> <Button variant="outline" onClick={() => setDialogOpen(false)}> Cancel </Button> <Button onClick={handleConfirmAction} className={dialogType === "approve" ? "bg-green-600 hover:bg-green-700" : ""} > {dialogType === "approve" ? "Confirm Approval" : "Send Request"} </Button> </DialogFooter> </DialogContent> </Dialog> </div> ); }
